import { Button, VerticalBox, HorizontalBox, ComboBox, ProgressIndicator, LineEdit } from "std-widgets.slint";

export component AppWindow inherits Window {
    title: "Firmware Assistant";
    width: 450px;
    height: 350px;
    background: #1e1e1e;
    default-font-size: 14px;

    // –í—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
    in property <[string]> device_list;
    in property <int> current_device_index: -1;
    in property <float> progress: 0.0;
    in property <string> status_text: "–ù–∞–∂–º–∏—Ç–µ '–ü–æ–∏—Å–∫' –¥–ª—è —Å—Ç–∞—Ä—Ç–∞";
    in property <bool> is_downloading: false;

    // –°–∏–≥–Ω–∞–ª—ã
    callback scan_clicked();
    callback download_clicked(int);
    callback device_selected(int); // –ú—ã —Å–∞–º–∏ –≤—ã—á–∏—Å–ª–∏–º –∏–Ω–¥–µ–∫—Å –≤ Rust, –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–¥–∏–º –∏–Ω–¥–µ–∫—Å

    VerticalBox {
        padding: 25px;
        spacing: 20px;

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        Text {
            text: "DEVICE UPDATER";
            font-size: 20px;
            font-weight: 900;
            color: #888888;
            horizontal-alignment: center;
        }

        VerticalBox {
            spacing: 5px;
            Text { text: "–í—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:"; color: #cccccc; font-size: 12px; }
            
            HorizontalBox {
                spacing: 10px;
                // ComboBox –≤ Slint 1.8 —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, –¥–∞–≤–∞–π —É–ø—Ä–æ—Å—Ç–∏–º
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ –∫–Ω–æ–ø–∫–∏ "–í–ø–µ—Ä–µ–¥/–ù–∞–∑–∞–¥" –µ—Å–ª–∏ ComboBox –≥–ª—é—á–∏—Ç,
                // –ù–æ –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ—á–∏–Ω–∏—Ç—å ComboBox.
                ComboBox {
                    model: root.device_list;
                    current-index: root.current_device_index;
                    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏: selected –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç, –Ω–æ current-index –º–µ–Ω—è–µ—Ç—Å—è —Å–∞–º
                    selected(text) => { 
                        // –ú—ã –Ω–µ –º–æ–∂–µ–º –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω–¥–µ–∫—Å –∏–∑ —Ç–µ–∫—Å—Ç–∞ –≤ Slint.
                        // –ü–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–ª–±—ç–∫ –∑–¥–µ—Å—å, 
                        // Rust –ø—Ä–æ—á–∏—Ç–∞–µ—Ç current-device-index —Å–∞–º.
                        // –ò–ª–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ö–∞–∫: 
                        root.device_selected(self.current-index);
                    }
                    height: 35px;
                    enabled: !root.is_downloading;
                }
                
                Button {
                    text: "üîÑ";
                    width: 40px;
                    clicked => { root.scan_clicked(); }
                    enabled: !root.is_downloading;
                }
            }
        }

        Rectangle {
            background: #252525;
            border-radius: 5px;
            height: 40px;
            Text {
                text: root.status_text;
                color: #aaaaaa;
                vertical-alignment: center;
                horizontal-alignment: center;
            }
        }

        if root.is_downloading : VerticalBox {
            spacing: 5px;
            Text { text: "–ó–∞–≥—Ä—É–∑–∫–∞..."; color: #4caf50; font-size: 12px; }
            ProgressIndicator {
                progress: root.progress;
                height: 8px;
            }
        }

        if root.current_device_index >= 0 && !root.is_downloading : HorizontalBox {
            spacing: 10px;
            Button {
                text: "–°–∫–∞—á–∞—Ç—å G HUB";
                primary: true;
                height: 40px;
                clicked => { root.download_clicked(0); }
            }
            Button {
                text: "–°–∫–∞—á–∞—Ç—å OMM";
                height: 40px;
                clicked => { root.download_clicked(1); }
            }
        }
    }
}